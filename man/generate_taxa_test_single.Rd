% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_taxa_test_single.R
\name{generate_taxa_test_single}
\alias{generate_taxa_test_single}
\title{Differential Abundance Testing for Single Time Point}
\usage{
generate_taxa_test_single(
  data.obj,
  time.var = NULL,
  t.level = NULL,
  group.var,
  ref.level = NULL,
  adj.vars = NULL,
  prev.filter = 0,
  abund.filter = 0,
  feature.level,
  feature.dat.type = c("count", "proportion", "other"),
  ...
)
}
\arguments{
\item{data.obj}{A MicrobiomeStat data object, which is a list containing
at minimum the following components:
\itemize{
  \item \code{feature.tab}: A matrix of feature abundances (taxa/genes as
    rows, samples as columns)
  \item \code{meta.dat}: A data frame of sample metadata (samples as rows)
}
Optional components include:
\itemize{
  \item \code{feature.ann}: A matrix/data frame of feature annotations
    (e.g., taxonomy)
  \item \code{tree}: A phylogenetic tree object (class "phylo")
  \item \code{feature.agg.list}: Pre-aggregated feature tables by taxonomy
}
Data objects can be created using converters like
\code{\link{mStat_convert_phyloseq_to_data_obj}} or importers like
\code{\link{mStat_import_qiime2_as_data_obj}}.}

\item{time.var}{Character string specifying the column name in meta.dat
containing the time variable. Required for longitudinal and paired analyses.
Should be a factor or character with meaningful time point labels.}

\item{t.level}{Character string specifying the time level/value to subset data to.
Default NULL does not subset data.}

\item{group.var}{Character string specifying the column name in meta.dat
containing the grouping variable (e.g., treatment, condition, phenotype).
Used for between-group comparisons.}

\item{ref.level}{Character string specifying the reference level for categorical group.var.
If NULL, the first level alphabetically is used. Ignored for continuous variables.}

\item{adj.vars}{Character vector specifying column names in meta.dat to be
used as covariates for adjustment in statistical models. These variables
will be included as fixed effects.}

\item{prev.filter}{Numeric value between 0 and 1. Features with prevalence
(proportion of non-zero samples) below this threshold will be excluded
from analysis. Default is usually 0 (no filtering).}

\item{abund.filter}{Numeric value. Features with mean abundance below this
threshold will be excluded from analysis. Default is usually 0 (no filtering).}

\item{feature.level}{Character vector specifying the taxonomic or annotation
level(s) for analysis. Should match column names in feature.ann, such as
"Phylum", "Family", "Genus", etc. Use "original" to analyze at the
original feature level without aggregation.}

\item{feature.dat.type}{Character string specifying the data type of
feature.tab. One of:
\itemize{
  \item "count": Raw count data (will be normalized)
  \item "proportion": Relative abundance data (should sum to 1 per sample)
  \item "other": Pre-transformed data (no transformation applied)
}}

\item{...}{Additional arguments passed to the linda function.}
}
\value{
A nested list structure where:
\itemize{
  \item First level: Named by \code{feature.level} (e.g., "Phylum", "Genus")
  \item Second level: Named by comparisons
        \itemize{
          \item For categorical \code{group.var}: One element per non-reference level,
                named as "Level vs Reference (Reference)" (e.g., "Treatment vs Control (Reference)")
          \item For continuous \code{group.var}: One element named by the variable name (e.g., "age")
        }
  \item Each element is a data.frame with the following columns:
        \itemize{
          \item \code{Variable}: Feature/taxon name
          \item \code{Coefficient}: Log2 fold change (for categorical) or slope coefficient (for continuous)
          \item \code{SE}: Standard error of the coefficient
          \item \code{P.Value}: Raw p-value from the statistical test
          \item \code{Adjusted.P.Value}: FDR-adjusted p-value using Benjamini-Hochberg method
          \item \code{Mean.Abundance}: Mean abundance of the feature across all samples
          \item \code{Prevalence}: Proportion of samples where the feature is present (non-zero)
        }
}
}
\description{
Performs differential abundance analysis using LinDA (for count/proportion data)
or standard linear models (for other data types). Automatically detects whether
the predictor is categorical or continuous.
}
\details{
## Statistical Methods

The function automatically selects the appropriate statistical method based on \code{feature.dat.type}:

**For "count" or "proportion" data:**
Uses LinDA (Linear models for Differential Abundance), which:
\itemize{
  \item Handles compositional nature of microbiome data
  \item Performs internal normalization (no pre-normalization needed)
  \item Handles zero-inflation via pseudo-count or imputation
  \item Corrects bias from centered log-ratio transformation
}

**For "other" data:**
Uses standard linear regression models, suitable for:
\itemize{
  \item Pre-transformed data (e.g., log-transformed, CLR-transformed)
  \item Data where compositional adjustments are not needed
}

## Variable Type Handling

The function automatically detects the type of \code{group.var}:

**Categorical variables (factor or character):**
\itemize{
  \item Uses dummy coding with k-1 coefficients for k levels
  \item First level (alphabetically) becomes the reference
  \item Each coefficient compares a level to the reference
  \item Example: For treatment groups A, B, C, output includes "B vs A (Reference)" and "C vs A (Reference)"
}

**Continuous variables (numeric or integer):**
\itemize{
  \item Uses single slope coefficient
  \item Tests for linear association with abundance
  \item Coefficient represents effect per unit increase
  \item Example: For age, coefficient shows abundance change per year
}

## Analysis Workflow

1. **Data Subsetting**: If \code{time.var} and \code{t.level} provided, subsets to that timepoint

2. **Feature Aggregation**: Aggregates features to specified taxonomic level if not "original"

3. **Filtering**: Applies prevalence and abundance filters

4. **Statistical Testing**: Runs LinDA or linear models depending on \code{feature.dat.type}

5. **Results Compilation**: Extracts coefficients, standard errors, p-values, and calculates
   FDR-adjusted p-values using Benjamini-Hochberg method

6. **Metadata Addition**: Adds mean abundance and prevalence for each feature

The function supports covariate adjustment via \code{adj.vars} and allows taxonomic
aggregation at multiple levels for customized analyses.
}
\examples{
\dontrun{
data(peerj32.obj)
test.list <- generate_taxa_test_single(
    data.obj = peerj32.obj,
    time.var = "time",
    t.level = "2",
    group.var = "group",
    adj.vars = "sex",
    feature.dat.type = "count",
    feature.level = c("Phylum","Genus","Family"),
    prev.filter = 0.1,
    abund.filter = 0.0001,
)
plot.list <- generate_taxa_volcano_single(
    data.obj = peerj32.obj,
    group.var = "group",
    test.list = test.list,
    feature.sig.level = 0.1,
    feature.mt.method = "none"
)
}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_taxa_test_pair.R
\name{generate_taxa_test_pair}
\alias{generate_taxa_test_pair}
\title{Paired/Longitudinal Taxa Differential Abundance Test}
\usage{
generate_taxa_test_pair(
  data.obj,
  subject.var,
  time.var = NULL,
  change.base = NULL,
  group.var = NULL,
  ref.level = NULL,
  adj.vars = NULL,
  feature.level,
  prev.filter = 0,
  abund.filter = 0,
  feature.dat.type = c("count", "proportion", "other"),
  ...
)
}
\arguments{
\item{data.obj}{A MicrobiomeStat data object, which is a list containing
at minimum the following components:
\itemize{
  \item \code{feature.tab}: A matrix of feature abundances (taxa/genes as
    rows, samples as columns)
  \item \code{meta.dat}: A data frame of sample metadata (samples as rows)
}
Optional components include:
\itemize{
  \item \code{feature.ann}: A matrix/data frame of feature annotations
    (e.g., taxonomy)
  \item \code{tree}: A phylogenetic tree object (class "phylo")
  \item \code{feature.agg.list}: Pre-aggregated feature tables by taxonomy
}
Data objects can be created using converters like
\code{\link{mStat_convert_phyloseq_to_data_obj}} or importers like
\code{\link{mStat_import_qiime2_as_data_obj}}.}

\item{subject.var}{Character string specifying the column name in meta.dat
that uniquely identifies each subject or sample unit. Required for
longitudinal and paired designs to track repeated measurements.}

\item{time.var}{Character string specifying the column name in meta.dat
containing the time variable. Required for longitudinal and paired analyses.
Should be a factor or character with meaningful time point labels.}

\item{change.base}{Value indicating the base/reference level for the time variable.
If NULL, the first level is used.}

\item{group.var}{Character string specifying the column name in meta.dat
containing the grouping variable (e.g., treatment, condition, phenotype).
Used for between-group comparisons.}

\item{ref.level}{Character string specifying the reference level for categorical group.var.
If NULL, the first level alphabetically is used. Ignored for continuous variables.}

\item{adj.vars}{Character vector specifying column names in meta.dat to be
used as covariates for adjustment in statistical models. These variables
will be included as fixed effects.}

\item{feature.level}{Character vector specifying the taxonomic or annotation
level(s) for analysis. Should match column names in feature.ann, such as
"Phylum", "Family", "Genus", etc. Use "original" to analyze at the
original feature level without aggregation.}

\item{prev.filter}{Numeric value between 0 and 1. Features with prevalence
(proportion of non-zero samples) below this threshold will be excluded
from analysis. Default is usually 0 (no filtering).}

\item{abund.filter}{Numeric value. Features with mean abundance below this
threshold will be excluded from analysis. Default is usually 0 (no filtering).}

\item{feature.dat.type}{Character string specifying the data type of
feature.tab. One of:
\itemize{
  \item "count": Raw count data (will be normalized)
  \item "proportion": Relative abundance data (should sum to 1 per sample)
  \item "other": Pre-transformed data (no transformation applied)
}}

\item{...}{Additional parameters passed to the linda function.}
}
\value{
A nested list structure where:
\itemize{
  \item First level: Named by \code{feature.level} (e.g., "Phylum", "Genus")
  \item Second level: Named by tested comparisons and effects
        \itemize{
          \item For categorical \code{group.var}: Elements named as
                "Level vs Reference (Reference) [Main Effect]" or "[Interaction]"
          \item For continuous \code{group.var}: Element named by the variable
          \item When \code{time.var} is provided: Both main effects and interaction effects
        }
  \item Each element is a data.frame with the following columns:
        \itemize{
          \item \code{Variable}: Feature/taxon name
          \item \code{Coefficient}: Log2 fold change for the comparison or time effect
          \item \code{SE}: Standard error of the coefficient
          \item \code{P.Value}: Raw p-value from LinDA's statistical test
          \item \code{Adjusted.P.Value}: FDR-adjusted p-value using Benjamini-Hochberg method
          \item \code{Mean.Abundance}: Mean abundance of the feature across all samples
          \item \code{Prevalence}: Proportion of samples where the feature is present (non-zero)
        }
}
}
\description{
Performs differential abundance analysis for paired or longitudinal data using
linear mixed-effects models via LinDA, accounting for subject-level correlations.
}
\details{
This function performs paired/longitudinal differential abundance analysis.
Each list element corresponds to a taxonomic level specified in \code{feature.level}.
The function uses linear mixed-effects models via LinDA to account for subject-level
correlations in paired or longitudinal data.
}
\examples{
\dontrun{
data(peerj32.obj)
test.list <- generate_taxa_test_pair(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = "time",
  group.var = "group",
  adj.vars = c("sex"),
  feature.level = c("Genus"),
  prev.filter = 0.1,
  abund.filter = 0.0001,
  feature.dat.type = "count"
)
plot.list <-
generate_taxa_volcano_single(
 data.obj = peerj32.obj,
 group.var = "group",
 test.list = test.list,
 feature.sig.level = 0.1,
 feature.mt.method = "none"
)

data("subset_pairs.obj")
test.list <- generate_taxa_test_pair(
  data.obj = subset_pairs.obj,
  subject.var = "MouseID",
  time.var = "Antibiotic",
  group.var = "Sex",
  adj.vars = NULL,
  feature.level = c("Genus"),
  prev.filter = 0.1,
  abund.filter = 0.0001,
  feature.dat.type = "count"
)
plot.list <-
generate_taxa_volcano_single(
 data.obj = subset_pairs.obj,
 group.var = "Sex",
 test.list = test.list,
 feature.sig.level = 0.1,
 feature.mt.method = "none"
)
}

}

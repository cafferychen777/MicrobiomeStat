% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_taxa_trend_test_long.R
\name{generate_taxa_trend_test_long}
\alias{generate_taxa_trend_test_long}
\title{Longitudinal Taxa Trend Test}
\usage{
generate_taxa_trend_test_long(
  data.obj,
  subject.var,
  time.var = NULL,
  group.var = NULL,
  ref.level = NULL,
  adj.vars = NULL,
  feature.level,
  prev.filter = 0,
  abund.filter = 0,
  feature.dat.type = c("count", "proportion", "other"),
  ...
)
}
\arguments{
\item{data.obj}{A MicrobiomeStat data object, which is a list containing
at minimum the following components:
\itemize{
  \item \code{feature.tab}: A matrix of feature abundances (taxa/genes as
    rows, samples as columns)
  \item \code{meta.dat}: A data frame of sample metadata (samples as rows)
}
Optional components include:
\itemize{
  \item \code{feature.ann}: A matrix/data frame of feature annotations
    (e.g., taxonomy)
  \item \code{tree}: A phylogenetic tree object (class "phylo")
  \item \code{feature.agg.list}: Pre-aggregated feature tables by taxonomy
}
Data objects can be created using converters like
\code{\link{mStat_convert_phyloseq_to_data_obj}} or importers like
\code{\link{mStat_import_qiime2_as_data_obj}}.}

\item{subject.var}{Character string specifying the column name in meta.dat
that uniquely identifies each subject or sample unit. Required for
longitudinal and paired designs to track repeated measurements.}

\item{time.var}{Character string specifying the column name in meta.dat
containing the time variable. Required for longitudinal and paired analyses.
Should be a factor or character with meaningful time point labels.}

\item{group.var}{Character string specifying the column name in meta.dat
containing the grouping variable (e.g., treatment, condition, phenotype).
Used for between-group comparisons.}

\item{ref.level}{Character string specifying the reference level for categorical group.var.
If NULL, the first level alphabetically is used. Ignored for continuous variables.}

\item{adj.vars}{Character vector specifying column names in meta.dat to be
used as covariates for adjustment in statistical models. These variables
will be included as fixed effects.}

\item{feature.level}{Character vector specifying the taxonomic or annotation
level(s) for analysis. Should match column names in feature.ann, such as
"Phylum", "Family", "Genus", etc. Use "original" to analyze at the
original feature level without aggregation.}

\item{prev.filter}{Numeric value between 0 and 1. Features with prevalence
(proportion of non-zero samples) below this threshold will be excluded
from analysis. Default is usually 0 (no filtering).}

\item{abund.filter}{Numeric value. Features with mean abundance below this
threshold will be excluded from analysis. Default is usually 0 (no filtering).}

\item{feature.dat.type}{Character string specifying the data type of
feature.tab. One of:
\itemize{
  \item "count": Raw count data (will be normalized)
  \item "proportion": Relative abundance data (should sum to 1 per sample)
  \item "other": Pre-transformed data (no transformation applied)
}}

\item{...}{Additional arguments passed to downstream functions.}
}
\value{
A nested list structure where:
\itemize{
  \item First level: Named by \code{feature.level} (e.g., "Phylum", "Genus")
  \item Second level: Named by tested effects (e.g., "time", "group:time interaction")
        \itemize{
          \item For categorical \code{group.var}: Separate elements for each non-reference level
                (e.g., "Treatment vs Control (Reference)")
          \item For continuous \code{group.var}: Single element named by the variable
          \item Time effects and interactions are also included depending on the model
        }
  \item Each element is a data.frame with the following columns:
        \itemize{
          \item \code{Variable}: Feature/taxon name
          \item \code{Coefficient}: Effect size. For time effects, represents change per unit time.
                For group effects, represents log2 fold change. For interactions, represents
                difference in trends between groups
          \item \code{SE}: Standard error of the coefficient
          \item \code{P.Value}: Raw p-value from the statistical test (mixed-effects model or LinDA)
          \item \code{Adjusted.P.Value}: FDR-adjusted p-value using Benjamini-Hochberg method
          \item \code{Mean.Abundance}: Mean abundance of the feature across all samples
          \item \code{Prevalence}: Proportion of samples where the feature is present (non-zero)
        }
}
}
\description{
Conducts longitudinal trend tests to analyze how microbial taxa abundance changes
over time and across groups using linear mixed-effects models.
}
\details{
Based on whether group.var, adj.vars, and time.var are NULL, the formula tests:

- When time.var is NULL:
  - When group.var is NULL and adj.vars is NOT NULL:
    - Tests adj.vars main effects only.
    - Adjusted for adj.vars but not for group.var or time.var.
  - When group.var is NOT NULL and adj.vars is NOT NULL:
    - Tests adj.vars and group.var main effects.
    - Adjusted for adj.vars but not for time.var.
  - When group.var is NOT NULL and adj.vars is NULL:
    - Tests group.var main effects only.
    - Unadjusted for adj.vars but adjusted for group.var.
  - When both group.var and adj.vars are NULL:
    - Tests the intercept only.
    - Unadjusted analysis.

- When time.var is NOT NULL:
  - When group.var is NULL and adj.vars is NOT NULL:
    - Tests adj.vars and time.var main effects.
    - Adjusted for adj.vars but not for group.var.
  - When group.var is NOT NULL and adj.vars is NOT NULL:
    - Tests adj.vars main effects.
    - Tests group.var and time.var main effects.
    - Tests group.var x time.var interaction.
    - Adjusted for adj.vars.
  - When group.var is NOT NULL and adj.vars is NULL:
    - Tests group.var and time.var main effects.
    - Tests group.var x time.var interaction.
    - Unadjusted analysis.
  - When both group.var and adj.vars are NULL:
    - Tests time.var main effect only.
    - Unadjusted analysis.

The formula combines the appropriate terms based on which variables are NULL.
Subject variability is accounted for through random effects.

When group.var = NULL and adj.vars = NULL and time.var is NOT NULL,
the slope of time.var is tested without adjusting for any additional covariates.
}
\examples{
\dontrun{
# Example 1
data("ecam.obj")
generate_taxa_trend_test_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  group.var = "delivery",
  adj.vars = "diet",
  feature.level = c("Phylum","Class"),
  feature.dat.type = c("proportion")
)
generate_taxa_trend_test_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  group.var = "delivery",
  feature.level = c("Phylum","Class"),
  feature.dat.type = c("proportion")
)
generate_taxa_trend_test_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  group.var = NULL,
  feature.level = c("Phylum","Class"),
  feature.dat.type = c("proportion")
)

# Example 2
data("subset_T2D.obj")
test.list <- generate_taxa_trend_test_long(
  data.obj = subset_T2D.obj,
  subject.var = "subject_id",
  time.var = "visit_number",
  group.var = "subject_race",
  adj.vars = "sample_body_site",
  prev.filter = 0.1,
  abund.filter = 0.001,
  feature.level = c("Genus","Family"),
  feature.dat.type = c("count")
)

plot.list <- generate_taxa_trend_volcano_long(
  data.obj = subset_T2D.obj,
  group.var = "subject_race",
  time.var = "visit_number_num",
  test.list = test.list,
  feature.mt.method = "none")

}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_feature_diversity.R
\name{plot_feature_diversity}
\alias{plot_feature_diversity}
\title{Visualize Feature Diversity}
\usage{
plot_feature_diversity(
  data.obj,
  group.var = NULL,
  strata.var = NULL,
  subject.var = NULL,
  time.var = NULL,
  time.point.plot,
  is.plot.change = TRUE,
  feature.change.func = "relative change",
  feature.level = NULL,
  feature.dat.type = c("count", "proportion", "other"),
  features.plot = NULL,
  prop.to.lump = 1e-04,
  top.k.plot = NULL,
  top.k.func = NULL,
  plot.other = TRUE,
  renormalize = FALSE,
  plot.scheme = c("combined", "individual"),
  plot.type = c("barplot", "dotplot", "areaplot", "heatmap", "spaghettiplot", "boxplot",
    "scatterplot")
)
}
\arguments{
\item{data.obj}{A MicrobiomeStat data object, which is a list containing
at minimum the following components:
\itemize{
  \item \code{feature.tab}: A matrix of feature abundances (taxa/genes as
    rows, samples as columns)
  \item \code{meta.dat}: A data frame of sample metadata (samples as rows)
}
Optional components include:
\itemize{
  \item \code{feature.ann}: A matrix/data frame of feature annotations
    (e.g., taxonomy)
  \item \code{tree}: A phylogenetic tree object (class "phylo")
  \item \code{feature.agg.list}: Pre-aggregated feature tables by taxonomy
}
Data objects can be created using converters like
\code{\link{mStat_convert_phyloseq_to_data_obj}} or importers like
\code{\link{mStat_import_qiime2_as_data_obj}}.}

\item{group.var}{Character string specifying the column name in meta.dat
containing the grouping variable (e.g., treatment, condition, phenotype).
Used for between-group comparisons.}

\item{strata.var}{Character string specifying the column name in meta.dat
for stratification. When provided, analyses and visualizations will be
performed separately within each stratum (e.g., by site, batch, or sex).}

\item{subject.var}{Character string specifying the column name in meta.dat
that uniquely identifies each subject or sample unit. Required for
longitudinal and paired designs to track repeated measurements.}

\item{time.var}{Character string specifying the column name in meta.dat
containing the time variable. Required for longitudinal and paired analyses.
Should be a factor or character with meaningful time point labels.}

\item{time.point.plot}{Character vector of time points to plot.}

\item{is.plot.change}{Logical, plot change from baseline (only for multiple time points).}

\item{feature.change.func}{Method for calculating change: "relative change", "log fold change", or "absolute change".}

\item{feature.level}{Character vector specifying the taxonomic or annotation
level(s) for analysis. Should match column names in feature.ann, such as
"Phylum", "Family", "Genus", etc. Use "original" to analyze at the
original feature level without aggregation.}

\item{feature.dat.type}{Character string specifying the data type of
feature.tab. One of:
\itemize{
  \item "count": Raw count data (will be normalized)
  \item "proportion": Relative abundance data (should sum to 1 per sample)
  \item "other": Pre-transformed data (no transformation applied)
}}

\item{features.plot}{Character vector of specific feature IDs to plot (default NULL plots all).}

\item{prop.to.lump}{Numeric, features below this mean proportion are lumped into "other".}

\item{top.k.plot}{Integer, number of top features to plot.}

\item{top.k.func}{Function to rank features for top.k selection.}

\item{plot.other}{Logical, whether to include "other" category in plots.}

\item{renormalize}{Logical, renormalize after removing "other" category.}

\item{plot.scheme}{Character, "combined" or "individual" plot layout.}

\item{plot.type}{Character, plot type: "barplot", "dotplot", "areaplot", "heatmap", "spaghettiplot", "boxplot", or "scatterplot".}
}
\value{
A list of ggplot objects.
}
\description{
Generates various plots to visualize relative abundance of taxa or functions
for both cross-sectional and longitudinal microbiome data.
}
\examples{
\donttest{
data(ecam.obj)
plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = NULL,
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "barplot"
)

# Get valid Phylum values (excluding empty strings and NAs)
valid_phyla <- unique(ecam.obj$feature.ann[,"Phylum"])
valid_phyla <- valid_phyla[!valid_phyla \%in\% c("__", "") & !is.na(valid_phyla)]
plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum"),
feature.dat.type = "proportion",
features.plot = valid_phyla[1:3],
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "dotplot"
)

plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "heatmap"
)

plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "boxplot"
)

plot_feature_diversity(
data.obj = ecam.obj,
group.var = "antiexposedall",
strata.var = "delivery",
time.var = "month",
time.point.plot = unique(ecam.obj$meta.dat$month)[1],
is.plot.change = TRUE,
feature.level = c("Phylum", "Family", "Genus"),
feature.dat.type = "proportion",
features.plot = NULL,
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "individual",
plot.type = "boxplot"
)

data(peerj32.obj)
plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = TRUE,
feature.change.func = "relative change",
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "boxplot"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = TRUE,
feature.change.func = "relative change",
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "individual",
plot.type = "boxplot"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = TRUE,
feature.change.func = "relative change",
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = "combined",
plot.type = "heatmap"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = FALSE,
feature.change.func = "relative change",
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "heatmap"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = FALSE,
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'individual',
plot.type = "boxplot"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = FALSE,
feature.level = c("Phylum", "Family", "Genus"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = FALSE,
feature.level = c("Family"),
features.plot = unique(peerj32.obj$feature.ann[, "Family"])[11:20],
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = peerj32.obj,
group.var = "group",
strata.var = "sex",
subject.var = "subject",
time.var = "time",
time.point.plot = c("1", "2"),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "dotplot"
)

data(subset_T2D.obj)
plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
features.plot = unique(subset_T2D.obj$feature.ann[, "Family"])[1:10],
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "barplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
features.plot = unique(subset_T2D.obj$feature.ann[, "Family"])[1:10],
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "areaplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "spaghettiplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'individual',
plot.type = "spaghettiplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "heatmap"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = TRUE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "heatmap"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'combined',
plot.type = "boxplot"
)

plot_feature_diversity(
data.obj = subset_T2D.obj,
group.var = "sample_body_site",
strata.var = "subject_race",
subject.var = "subject_id",
time.var = "visit_number_num",
time.point.plot = unique(subset_T2D.obj$meta.dat$visit_number_num),
is.plot.change = FALSE,
feature.level = c("Family"),
prop.to.lump = 0.0001,
top.k.plot = NULL,
top.k.func = NULL,
renormalize = FALSE,
plot.other = TRUE,
plot.scheme = 'individual',
plot.type = "boxplot"
)
}
}
